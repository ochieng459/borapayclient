<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auth • Login / Sign Up</title>
  <style>
        :root{
      --bg:#0b0f19; --card:#121826; --muted:#9aa4b2; --text:#e5e7eb; --brand:#7c3aed; --brand-2:#22d3ee;
      --ring: 0 0 0 4px color-mix(in oklab, var(--brand) 25%, transparent);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background: radial-gradient(1200px 800px at 10% -10%, #1f1144 0%, transparent 60%),
                  radial-gradient(900px 600px at 110% 20%, #0a3a4a 0%, transparent 55%),
                  var(--bg);
      color:var(--text); min-height:100svh; display:grid; place-items:center; padding:24px;
    }
    .card{
      width:100%; max-width:960px; background:color-mix(in oklab, var(--card) 92%, #fff 0%);
      border:1px solid #1f2937; border-radius:24px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,.35);
      display:grid; grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width:900px){ .card{grid-template-columns:1fr} .art{display:none} }
    .art{
      background: linear-gradient(135deg, color-mix(in oklab,var(--brand) 60%, #000 20%) 0%, color-mix(in oklab,var(--brand-2) 60%, #000 20%) 100%);
      position:relative; padding:40px; display:flex; align-items:end; justify-content:flex-start;
    }
    .art::after{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(200px 200px at 20% 20%, rgba(255,255,255,.15), transparent 60%),
        radial-gradient(320px 220px at 80% 10%, rgba(255,255,255,.08), transparent 70%);
         mix-blend-mode: screen;
    }
    .art h2{ margin:0; font-size:28px; line-height:1.2 }
    .panel{ padding:28px; display:flex; flex-direction:column; gap:20px }
    .tabs{ display:flex; gap:16px; border-bottom:1px solid #1f2937; padding-bottom:8px }
    .tab{
      appearance:none; background:transparent; border:0; color:var(--muted); font-weight:600; padding:10px 4px;
      cursor:pointer; position:relative; transition:.2s color;
    }
    .tab.active{ color:#fff }
    .tab.active::after{
      content:""; position:absolute; left:0; right:0; bottom:-9px; height:2px;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      border-radius:2px; box-shadow:0 0 16px color-mix(in oklab,var(--brand) 40%, transparent);
    }
    .stack{ display:flex; flex-direction:column; gap:14px; margin-top:6px }
    label{ font-size:12px; color:var(--muted) }
    .input{
      display:flex; align-items:center; gap:10px; background:#0f1422; border:1px solid #1f2937; border-radius:14px; padding:12px 14px;
    }
    .input input{
      width:100%; background:transparent; border:0; outline:0; color:#fff; font-size:15px;
    }
    .input:focus-within{ border-color:color-mix(in oklab, var(--brand) 50%, #1f2937); box-shadow:var(--ring) }
    .row{ display:flex; justify-content:space-between; align-items:center; gap:14px; margin-top:4px }
    .link{ color:var(--brand-2); text-decoration:none; font-size:13px }
    .btn{
      appearance:none; border:0; background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#071019;
      padding:12px 16px; border-radius:14px; font-weight:700; cursor:pointer; transition: transform .05s ease;
    }
    .btn:active{ transform: translateY(1px) }
    .muted{ color:var(--muted); font-size:13px }
    .hidden{ display:none }
    .social{ display:flex; gap:10px; }
    .sbtn{ flex:1; padding:10px 12px; border:1px solid #243044; border-radius:12px; background:#0f1422; color:#d1d5db; cursor:pointer }
    .separator{ display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px; }
    .separator::before, .separator::after{ content:""; height:1px; background:#1f2937; flex:1 }
    small.error{ color:#fca5a5; display:none }
  </style>
</head>
<body>
  <main class="card">
    <section class="panel">
      <div class="tabs">
        <button id="tLogin" class="tab active">Login</button>
        <button id="tSignup" class="tab">Sign Up</button>
      </div>

      <!-- Login -->
      <form id="loginForm" class="stack" novalidate>
        <div>
          <label>Email</label>
          <div class="input"><input type="email" name="email" placeholder="you@example.com" required /></div>
          <small class="error" data-for="email">Enter a valid email</small>
        </div>
        <div>
          <label>Password</label>
          <div class="input"><input type="password" name="password" placeholder="••••••••" minlength="6" required /></div>
          <small class="error" data-for="password">Min 6 characters</small>
        </div>
        <div>
  <label>PIN</label>
  <div class="input"><input type="password" name="pin" placeholder="4-6 digit PIN" minlength="4" maxlength="6" required /></div>
  <small class="error" data-for="pin">Enter a valid PIN</small>
</div>

        <div class="row">
          <label class="muted"><input type="checkbox" /> Remember me</label>
          <a class="link" href="#">Forgot password?</a>
        </div>
        <button class="btn" type="submit">Sign in</button>

        <div class="separator">or continue with</div>
        <div class="social">
          <button class="sbtn" type="button">Google</button>
          <button class="sbtn" type="button">Facebook</button>
        </div>

        <p class="muted">No account? <a class="link" href="#" id="goSignup">Create one</a></p>
      </form>

      <!-- Sign Up -->
      <form id="signupForm" class="stack hidden" novalidate>
        <div class="row" style="gap:12px">
          <div style="flex:1">
            <label>First name</label>
            <div class="input"><input type="text" name="first" placeholder="Jane" required /></div>
            <small class="error" data-for="first">First name required</small>
          </div>
          <div style="flex:1">
            <label>Last name</label>
            <div class="input"><input type="text" name="last" placeholder="Doe" required /></div>
            <small class="error" data-for="last">Last name required</small>
          </div>
        </div>
        <div>
          <label>Email</label>
          <div class="input"><input type="email" name="email" placeholder="you@example.com" required /></div>
          <small class="error" data-for="email">Enter a valid email</small>
        </div>
        <div>
          <label>Password</label>
          <div class="input"><input type="password" name="password" placeholder="Min 6 characters" minlength="6" required /></div>
          <small class="error" data-for="password">Min 6 characters</small>
        </div>
        <div>
          <label>Confirm password</label>
          <div class="input"><input type="password" name="confirm" placeholder="Repeat password" minlength="6" required /></div>
          <small class="error" data-for="confirm">Passwords must match</small>
        </div>
        <div>
  <label>PIN</label>
  <div class="input"><input type="password" name="pin" placeholder="4-6 digit PIN" minlength="4" maxlength="6" required /></div>
  <small class="error" data-for="pin">Enter a valid PIN</small>
</div>

        <button class="btn" type="submit">Create account</button>

        <p class="muted">Already have an account? <a class="link" href="#" id="goLogin">Sign in</a></p>
      </form>
    </section>

    <aside class="art">
      <h2>Welcome to the future of payments.</h2>
    </aside>
  </main>

  <!-- Supabase Auth Script -->
  <!-- Replace your current signup JS part with this -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";
import bcrypt from "https://esm.sh/bcryptjs";

const supabaseUrl = "https://oaejnmigzuodvzszldjl.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hZWpubWlnenVvZHZ6c3psZGpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1Mjg3NDAsImV4cCI6MjA3MTEwNDc0MH0.pJCuMhExU89-uJrO8_hFzfK2ztVz1rZUjtYOygdSzG4";
const supabase = createClient(supabaseUrl, supabaseKey);

// Tabs
const tLogin = document.getElementById('tLogin');
const tSignup = document.getElementById('tSignup');
const loginForm = document.getElementById('loginForm');
const signupForm = document.getElementById('signupForm');
const goSignup = document.getElementById('goSignup');
const goLogin = document.getElementById('goLogin');

function show(tab){
  const loginActive = tab === 'login';
  tLogin.classList.toggle('active', loginActive);
  tSignup.classList.toggle('active', !loginActive);
  loginForm.classList.toggle('hidden', !loginActive);
  signupForm.classList.toggle('hidden', loginActive);
}

tLogin.onclick = () => show('login');
tSignup.onclick = () => show('signup');
goSignup && (goSignup.onclick = (e)=>{ e.preventDefault(); show('signup'); });
goLogin && (goLogin.onclick = (e)=>{ e.preventDefault(); show('login'); });

// Minimal validation
function setError(input, msg){
  const small = input.closest('div').parentElement.querySelector('.error[data-for="'+input.name+'"]');
  if(small){ small.textContent = msg; small.style.display = msg ? 'block' : 'none'; }
}

function validate(form){
  let ok = true;
  form.querySelectorAll('input[required]').forEach(inp=>{
    if(!inp.value.trim()) { setError(inp, 'This field is required'); ok=false; }
    else if(inp.name==='email' && !/^\S+@\S+\.\S+$/.test(inp.value)){ setError(inp,'Enter a valid email'); ok=false; }
    else if(inp.name==='password' && inp.value.length < 6){ setError(inp,'Min 6 characters'); ok=false; }
    else { setError(inp,''); }
  });

  if(form.id==='signupForm'){
    const p = form.querySelector('input[name="password"]');
    const c = form.querySelector('input[name="confirm"]');
    if(p.value !== c.value){ setError(c,'Passwords must match'); ok=false; }
  }
  return ok;
}

// LOGIN
loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!validate(loginForm)) return;

  const email = loginForm.querySelector('input[name="email"]').value;
  const password = loginForm.querySelector('input[name="password"]').value;
  const pin = loginForm.querySelector('input[name="pin"]').value;

  // sign in with Supabase
  const { data: authData, error: authError } = await supabase.auth.signInWithPassword({ email, password });
  if(authError){ alert("Login failed: " + authError.message); return; }

  // fetch user's profile PIN hash
  const { data: profile, error: profErr } = await supabase
    .from("profiles")
    .select("pin_hash")
    .eq("user_id", authData.user.id)
    .single();

  if(profErr){ alert("Profile fetch failed: "+profErr.message); return; }

  const pinMatch = await bcrypt.compare(pin, profile.pin_hash);
  if(!pinMatch){ alert("Incorrect PIN"); return; }

  // successful login
  window.location.href = "home.html";
});

// SIGNUP
// SIGNUP with Supabase + PIN
signupForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!validate(signupForm)) return;

  const email = signupForm.querySelector('input[name="email"]').value;
  const password = signupForm.querySelector('input[name="password"]').value;
  const first = signupForm.querySelector('input[name="first"]').value;
  const last = signupForm.querySelector('input[name="last"]').value;
  const pin = signupForm.querySelector('input[name="pin"]').value;

  const { data: authData, error: authError } = await supabase.auth.signUp({ email, password });
  if(authError){ alert("Signup failed: " + authError.message); return; }

  const hashedPin = await bcrypt.hash(pin, 10);

  // create profile row
  const { error: profErr } = await supabase.from("profiles").insert([{
    user_id: authData.user.id,
    full_name: first + " " + last,
    email,
    pin_hash: hashedPin
  }]);
  if(profErr){ alert("Profile creation failed: "+profErr.message); return; }

  // create wallet row
  const { error: walletErr } = await supabase.from("wallets").insert([{
    user_id: authData.user.id,
    balance: 0
  }]);
  if(walletErr){ alert("Wallet creation failed: "+walletErr.message); return; }

  // create PIN row for send money
  const { error: pinErr } = await supabase.from("pins").insert([{
    user_id: authData.user.id,
    pin: pin // store plain PIN or hashed depending on how send-money code expects it
  }]);
  if(pinErr){ alert("PIN creation failed: "+pinErr.message); return; }

  window.location.href = "home.html";
});

</script>

</script>


  </script>
</body>
</html>